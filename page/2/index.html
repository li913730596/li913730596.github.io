<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-11-20/devtool" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/13/11-20/devtool/" class="article-date">
  <time datetime="2023-04-13T11:49:25.941Z" itemprop="datePublished">2023-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/13/11-20/devtool/">热部署</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>导入依赖和插件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改编译器的配置</li>
</ul>
<p><img src="https://s1.ax1x.com/2023/04/13/ppxdlXn.png" alt="ppxdlXn.png"></p>
<p>然后点击下图，即可完成热部署。</p>
<p><img src="https://s1.ax1x.com/2023/04/13/ppxdG7V.png" alt="image-20230413195603764"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/13/11-20/devtool/" data-id="clggal31u000e6gu8f3cnbm5b" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-project1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/13/project1/" class="article-date">
  <time datetime="2023-04-13T11:49:04.830Z" itemprop="datePublished">2023-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/13/project1/" data-id="clggal31o00026gu80t5l8q36" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-11-20/filterandIntercepter" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/13/11-20/filterandIntercepter/" class="article-date">
  <time datetime="2023-04-13T07:17:10.487Z" itemprop="datePublished">2023-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/13/11-20/filterandIntercepter/">Filter(过滤器)和Interceptor(拦截器)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Filter（只用在Web程序）"><a href="#Filter（只用在Web程序）" class="headerlink" title="Filter（只用在Web程序）"></a>Filter（只用在Web程序）</h3><ul>
<li>filter是servlet里的配置，与springMVC框架无关，他会从servlet服务启动开始时就进行初始化。</li>
</ul>
<ul>
<li>构建一个自定义的Filter需要实现Filter接口中的三个方法。 （<strong>实现Filter接口</strong>）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &#123;&quot;/*&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤之前&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">start</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>().getTime();</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤结束，用时： &quot;</span> + (<span class="keyword">new</span> <span class="title class_">Date</span>().getTime() - start));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>将自定义的Filter加入系统有两种方式：</p>
<p>1.如上图所示在自定义类上添加注解：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@WebFilter(urlPatterns = &#123;&quot;/*&quot;&#125;)</span><br><span class="line">@Component</span><br><span class="line">public class TimeFilter implements Filter &#123;</span><br><span class="line">***</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.添加一个配置类，将自定义类注册为Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">timeFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">filterRegistrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">        <span class="type">TimeFilter</span> <span class="variable">timeFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimeFilter</span>();</span><br><span class="line">        filterRegistrationBean.setFilter(timeFilter);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; urlList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        urlList.add(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        filterRegistrationBean.setUrlPatterns(urlList);</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Interceptor（用于Spring框架）"><a href="#Interceptor（用于Spring框架）" class="headerlink" title="Interceptor（用于Spring框架）"></a>Interceptor（用于Spring框架）</h2><ul>
<li>这是SpringMVC的东西，它的范围要比Filter小。并且它是基于Java反射机制的，可以获取方法的相关信息。</li>
<li>实现一个自定义的拦截器，需要实现<strong>HandlerInterceptor接口</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/13/11-20/filterandIntercepter/" data-id="clggal31u000g6gu8bo9jhe2n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-11-20/error" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/09/11-20/error/" class="article-date">
  <time datetime="2023-04-09T15:00:42.793Z" itemprop="datePublished">2023-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/09/11-20/error/">异常处理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>当应用中产生异常时，Spring Boot根据发送请求头中的<code>accept</code>是否包含<code>text/html</code>来分别返回不同的响应信息。当从浏览器地址栏中访问应用接口时，请求头中的<code>accept</code>便会包含<code>text/html</code>信息，产生异常时，Spring Boot通过<code>org.springframework.web.servlet.ModelAndView</code>对象来装载异常信息，并以HTML的格式返回；而当从客户端访问应用接口产生异常时（客户端访问时，请求头中的<code>accept</code>不包含<code>text/html</code>），Spring Boot则以JSON的格式返回异常信息。下面来验证一下。</li>
</ul>
<p><img src="https://s1.ax1x.com/2023/04/09/ppb0yBF.png" alt="ppb0yBF.png"></p>
<ul>
<li>查看Spring Boot的<code>BasicErrorController</code>类便可看到这一默认机制的具体实现：</li>
</ul>
<p><img src="https://mrbird.cc/img/111111.png" alt="QQ图片20180701165727.png"></p>
<p>可看到<code>errorHtml</code>和<code>error</code>方法的请求地址和方法是一样的，唯一的区别就是<code>errorHtml</code>通过<code>produces = &#123;&quot;text/html&quot;&#125;</code>判断请求头的<code>accpet</code>属性中是否包含<code>text/html</code>，如果包含，便走该方法。</p>
<p>关于 produces参数含义可参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f78b43f048e6">https://www.jianshu.com/p/f78b43f048e6</a></p>
<ul>
<li>自定义异常界面：我们可以通过在<code>src/main/resources/resources/error</code>路径下自定义友好的异常页面</li>
</ul>
<ul>
<li>自定义异常处理：</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/09/11-20/error/" data-id="clggal31u000f6gu82zzz3u04" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-11-20/logback" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/09/11-20/logback/" class="article-date">
  <time datetime="2023-04-09T14:55:08.183Z" itemprop="datePublished">2023-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/09/11-20/logback/">日志配置（logback）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://logback.qos.ch/">Logback</a>是log4j框架的作者开发的新一代日志框架，它效率更高、能够适应诸多的运行环境，同时天然支持SLF4J。默认情况下，Spring Boot会用Logback来记录日志，并用INFO级别输出到控制台。在运行应用程序和其他例子时，你应该已经看到很多INFO级别的日志了</li>
</ul>
<p>后面再补…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/09/11-20/logback/" data-id="clggal31u000h6gu89nrkcjsj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JAVA/JUC_3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/09/JAVA/JUC_3/" class="article-date">
  <time datetime="2023-04-09T13:54:48.371Z" itemprop="datePublished">2023-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/09/JAVA/JUC_3/">并发第四章</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>避免临界区的静态条件（不确定结果）的发生<ul>
<li>阻塞式方案：synchronized（对象锁） ， Lock</li>
<li>非阻塞式解决方案：原子变量</li>
</ul>
</li>
</ul>
<p>synchornized加锁必须要   <strong>同时加同一个锁</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//synchornized用法的等价形式：</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//形式一：加在静态方法上</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//形式二： 锁住类对象  等价于 形式一</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (Test.class)&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Test&#123;</span><br><span class="line">//形式一</span><br><span class="line">    public synchronized void test()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//形式二   锁住当前对象</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        synchronized (this)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>线程八锁（<a target="_blank" rel="noopener" href="https://blog.csdn.net/F15217283411/article/details/122752255%EF%BC%89">https://blog.csdn.net/F15217283411/article/details/122752255）</a>  <u>只需判断是否是同一把锁</u></li>
</ul>
<hr>
<p>局部变量：是线程安全的（不与其他线程共享）</p>
<p>​        特别的，当变量为引用类型的时候，需要访问堆中数据，堆中数据为共享的。 （这时候可以将共用类型设置为局部变量）</p>
<p>private  和  final  修饰符  就可以进一步确保线程安全。（原因是，加上这些·修饰符，子类不能重写函数了）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">复习一波  子类重写父类</span></span><br><span class="line"><span class="comment">* 子类重写(覆盖)父类的方法必须满足的条件：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 1.父类中的方法在子类中必须可见，即子类继承了父类中的该方法(可以显式的使用super关键字来访问父类中的被重写的方法)，</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 如果父类中的方法为private类型的，那么子类则无法继承，也无法覆盖。   </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 2.子类和父类的方法必须是实例方法，如果父类是static方法而子类是实例方法，或者相反都会报错。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 如果父类和子类都是static方法，那么子类隐藏父类的方法，而不是重写父类方法。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 3.子类和父类的方法必须要具有相同的函数名称、参数列表，并且子类的返回值与父类相同或者是父类返回类型的子类型(jdk1.5之后)。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 如果方法名称相同而参数列表不同(返回类型可以相同也可以不同)，那么只是方法的重载，而非重写。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 如果方法名称和参数列表相同，返回值类型不同，子类返回值类型也不是父类返回值类型的子类，编译器就会报错。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 4.子类方法的访问权限不能小于父类方法的访问权限(可以具有相同的访问权限或者子类的访问权限大于父类)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 访问权限由高到低：public、protected、包访问权限、private。如果子类方法的访问权限低于父类，则编译器会给出错误信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 5.子类方法不能比父类方法抛出更多的编译时异常(不是运行时异常)，即子类方法抛出的编译时异常或者和父类相同或者是父类异常的子类。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">原文链接：https://blog.csdn.net/weixin_30110807/article/details/114037808</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<ul>
<li> 另外  <strong>final</strong>可用于声明<strong>属性、方法和类</strong>，分别表示<strong>属性不可变，方法不可重写，类不可继承</strong>。</li>
</ul>
<hr>
<p>4.10</p>
<ul>
<li>不可变类 线程安全</li>
<li>一些 包装类线程安全</li>
</ul>
<p>4.12</p>
<h3 id="Monitor-锁-（监视器-管程）"><a href="#Monitor-锁-（监视器-管程）" class="headerlink" title="Monitor(锁)  （监视器/管程）"></a>Monitor(锁)  （监视器/管程）</h3><ul>
<li>轻量级锁</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/09/JAVA/JUC_3/" data-id="clggal31q00056gu83q62hag1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JAVA/JUC_2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/08/JAVA/JUC_2/" class="article-date">
  <time datetime="2023-04-08T07:32:05.185Z" itemprop="datePublished">2023-04-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/08/JAVA/JUC_2/">初级并发2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="两阶段终止模式"><a href="#两阶段终止模式" class="headerlink" title="两阶段终止模式"></a>两阶段终止模式</h3><p><img src="https://i.328888.xyz/2023/04/08/i3YIhV.png" alt="image-20230408153303612"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">TwoPhaseTermination</span> <span class="variable">tpt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TwoPhaseTermination</span>();</span><br><span class="line">        tpt.start();</span><br><span class="line">        Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">        tpt.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TwoPhaseTermination</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Thread monitor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>&#123;</span><br><span class="line">        monitor = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!currentThread().isInterrupted()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                        log.debug(<span class="string">&quot;执行监控&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        <span class="comment">//重新标记打断</span></span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;处理后事&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        monitor.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span>&#123;</span><br><span class="line">        monitor.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p><code>LockSupport.park();</code> 会使得线程停下。然后使用interrupt()将park()打断，线程才会继续执行。并且打断park()之后的打断标记依旧存在，再次调用park()就无法停下，需要将打断标记置为false，这时候就需要使用<code>interrupted()</code>方法,既可以打断程序，又能清楚打断标记。</p>
</li>
<li><p>守护线程： （可参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/quanxiaoha/p/10731361.html%EF%BC%89">https://www.cnblogs.com/quanxiaoha/p/10731361.html）</a></p>
</li>
</ul>
<ul>
<li><p>Java中的6种状态： </p>
<p><img src="https://s1.ax1x.com/2023/04/09/ppbYwL9.png" alt="ppbYwL9.png"></p>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2023/04/09/ppbtfpT.png" alt="ppbtfpT.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/08/JAVA/JUC_2/" data-id="clggal31q00066gu85x8bca2k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-11-20/mail" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/08/11-20/mail/" class="article-date">
  <time datetime="2023-04-08T05:07:53.091Z" itemprop="datePublished">2023-04-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/08/11-20/mail/">使用SpringBoot发邮件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>引入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在配置文件进行配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.qq.com</span></span><br><span class="line">    <span class="attr">username:</span> <span class="number">88888888</span><span class="string">@qq.com</span>   <span class="comment">#自己的qq</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">fmxazkhvfntbbbcf</span>  <span class="comment">#qq邮箱的授权码</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#上面是主要配置</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">mail:</span></span><br><span class="line">        <span class="attr">smtp:</span></span><br><span class="line">          <span class="attr">auth:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">starttls:</span></span><br><span class="line">            <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">required:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>详情参考：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021587834">https://segmentfault.com/a/1190000021587834</a></p>
<ul>
<li>使用模板发送邮件</li>
</ul>
<p>1.首先需要引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.在templates下创建一个模板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>模板<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    您好，您的验证码为&#123;code&#125;，请在两分钟内使用完成操作。</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.进行发送</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;sendTemplateEmail&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">sendTemplateEmail</span><span class="params">(String code)</span> &#123;</span><br><span class="line">       <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           message = jms.createMimeMessage();</span><br><span class="line">           <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">           helper.setFrom(from); </span><br><span class="line">           helper.setTo(<span class="string">&quot;888888@qq.com&quot;</span>); <span class="comment">// 接收地址</span></span><br><span class="line">           helper.setSubject(<span class="string">&quot;邮件摸板测试&quot;</span>); <span class="comment">// 标题</span></span><br><span class="line">           <span class="comment">// 处理邮件模板</span></span><br><span class="line">           <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">           context.setVariable(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">           <span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> templateEngine.process(<span class="string">&quot;emailTemplate&quot;</span>, context);</span><br><span class="line">           helper.setText(template, <span class="literal">true</span>);</span><br><span class="line">           jms.send(message);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;发送成功&quot;</span>;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           <span class="keyword">return</span> e.getMessage();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>





<ul>
<li>发送普通邮件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> JavaMailSender jms;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;spring.mail.username&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String from;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/sendSimpleEmail&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">sendSimpleEmail</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="type">SimpleMailMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line">          message.setFrom(from);</span><br><span class="line">          message.setTo(<span class="string">&quot;8888888@qq.com&quot;</span>); <span class="comment">// 接收地址  目标人的qq邮箱</span></span><br><span class="line">          message.setSubject(<span class="string">&quot;一封简单的邮件&quot;</span>); <span class="comment">// 标题</span></span><br><span class="line">          message.setText(<span class="string">&quot;使用Spring Boot发送简单邮件。&quot;</span>); <span class="comment">// 内容</span></span><br><span class="line">          jms.send(message);</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;发送成功&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">          <span class="keyword">return</span> e.getMessage();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<ul>
<li>发送Html邮件</li>
</ul>
<p>改造<code>EmailController</code>，<code>SimpleMailMessage</code>替换为<code>MimeMessage</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;sendHtmlEmail&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">sendHtmlEmail</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           message = jms.createMimeMessage();</span><br><span class="line">           <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">           helper.setFrom(from);</span><br><span class="line">           helper.setTo(<span class="string">&quot;888888@qq.com&quot;</span>); <span class="comment">// 接收地址</span></span><br><span class="line">           helper.setSubject(<span class="string">&quot;一封HTML格式的邮件&quot;</span>); <span class="comment">// 标题</span></span><br><span class="line">           <span class="comment">// 带HTML格式的内容</span></span><br><span class="line">           <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;&lt;p style=&#x27;color:#6db33f&#x27;&gt;使用Spring Boot发送HTML格式邮件。&lt;/p&gt;&quot;</span>);</span><br><span class="line">           helper.setText(sb.toString(), <span class="literal">true</span>);</span><br><span class="line">           jms.send(message);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;发送成功&quot;</span>;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           <span class="keyword">return</span> e.getMessage();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>发送带附件的邮箱</li>
</ul>
<p>发送带附件的邮件和普通邮件相比，其实就只是多了个传入附件的过程。不过使用的仍是<code>MimeMessage</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/sendAttachmentsMail&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">sendAttachmentsMail</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           message = jms.createMimeMessage();</span><br><span class="line">           <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">           helper.setFrom(from);</span><br><span class="line">           helper.setTo(<span class="string">&quot;913730596@qq.com&quot;</span>); <span class="comment">// 接收地址</span></span><br><span class="line">           helper.setSubject(<span class="string">&quot;一封带附件的邮件&quot;</span>); <span class="comment">// 标题</span></span><br><span class="line">           helper.setText(<span class="string">&quot;详情参见附件内容！&quot;</span>); <span class="comment">// 内容</span></span><br><span class="line">           <span class="comment">// 传入附件</span></span><br><span class="line">           <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;a.txt&quot;</span>);</span><br><span class="line">           <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> resource.getFile();</span><br><span class="line">           <span class="comment">//FileSystemResource file = new FileSystemResource(new File(&quot;classpath:/a.txt&quot;));</span></span><br><span class="line">           helper.addAttachment(<span class="string">&quot;a.txt&quot;</span>, file);</span><br><span class="line">           jms.send(message);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;发送成功&quot;</span>;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           <span class="keyword">return</span> e.getMessage();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>





<p>​        这里的文件路径：<code>Resource resource = new ClassPathResource(&quot;a.txt&quot;);</code>该语句将文件路径获取到，然后在获取文件资源<code>File file = resource.getFile();</code>。</p>
<p>​        详细可参考：<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15127619/4531376">https://blog.51cto.com/u_15127619/4531376</a></p>
<ul>
<li>发送带静态资源的Html</li>
</ul>
<p>​    发送带静态资源的邮件其实就是在发送HTML邮件的基础上嵌入静态资源（比如图片），嵌入静态资源的过程和传入附件类似，唯一的区别在于需要标识资源的cid：<code>helper.setText(&quot;&lt;html&gt;&lt;body&gt;博客图：&lt;img src=&#39;cid:img&#39;/&gt;&lt;/body&gt;&lt;/html&gt;&quot;, true);</code> 这里面的<code>cid:img</code>。与下面的<code>helper.addInline(&quot;img&quot;, file);</code>相对应即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helper.setText(<span class="string">&quot;&lt;html&gt;&lt;body&gt;博客图：&lt;img src=&#x27;cid:img&#x27;/&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>, <span class="literal">true</span>); <span class="comment">// 内容</span></span><br><span class="line"><span class="comment">// 传入附件</span></span><br><span class="line"><span class="type">FileSystemResource</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;src/main/resources/static/img/sunshine.png&quot;</span>));</span><br><span class="line">helper.addInline(<span class="string">&quot;img&quot;</span>, file); </span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/08/11-20/mail/" data-id="clggal31v000i6gu87m355nw9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JAVA/JUC" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/07/JAVA/JUC/" class="article-date">
  <time datetime="2023-04-07T07:13:36.860Z" itemprop="datePublished">2023-04-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/07/JAVA/JUC/">并发初级</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="4-7"><a href="#4-7" class="headerlink" title="4.7"></a>4.7</h3><p>并发 (deal)  并行（do）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">//方法一</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">                log.info(<span class="string">&quot;inThread&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread.setName(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//方法一的简化：利用lamaba</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; log.info(<span class="string">&quot;inThread&quot;</span>)).start();</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">		<span class="comment">//方法二：利用Runnable接口</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">inThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;inThread&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(inThread, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;outThread&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>针对Runnable 接口  和  Thread直接创建这两种方式， 推荐使用Runnable接口的实现，这样就可以将我们创建的任务与Thread类分离开。</li>
</ul>
<ul>
<li>第三种创建线程的方式：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Callable</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                log.info(<span class="string">&quot;inThread&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask,<span class="string">&quot;t3&quot;</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(futureTask.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">-----------</span><br><span class="line">结果：</span><br><span class="line"><span class="number">2023</span>-<span class="number">04</span>-<span class="number">07</span> <span class="number">16</span>:<span class="number">05</span>:<span class="number">25.435</span>  INFO <span class="number">4032</span> --- [  t3] com.example.Jucday01ApplicationTests     : inThread</span><br><span class="line"><span class="number">100</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/642fcdc7a682492fcc520dff.png" alt="image-20230407160047480"></p>
<p><img src="https://pic.imgdb.cn/item/642fd047a682492fcc559865.png" alt="image-20230407161142009"></p>
<p>​        <strong>本质上还是继承了Runnable,只不过为了能够得到线程中任务的返回值，需要传入一个Callable接口的参数，这个接口下的call方法是有返回值的。 同时又因为，FutureTask继承了Future接口 所以可以用get()方法获取call方法的返回值。</strong></p>
<ul>
<li>线程上下文切换：cpu不再执行当前的线程，转而执行另一个线程。每次切换线程时，操作系统都需要记录线程当前的状态（记录现场）    </li>
</ul>
<p><img src="https://pic.imgdb.cn/item/642fff96a682492fcccca49d.png" alt="image-20230407193313881"></p>
<ul>
<li>栈帧：每多开一个线程，jvm都会给它开辟一块栈空间，叫做栈帧。</li>
</ul>
<h3 id="4-8"><a href="#4-8" class="headerlink" title="4.8"></a>4.8</h3><ul>
<li>常用方法</li>
</ul>
<hr>
<p>join()        等待线程运行结束  ；  join(n)  最多等n毫秒；</p>
<p>getState()  获取线程状态；</p>
<p>isInterrupted() 判断是否打断；</p>
<p>isAlive()  判断线程是否存活；</p>
<p>currentThread()   获取当前线程；</p>
<p>sleep(n)      休眠n毫秒，让出cpu（但不释放锁）</p>
<p>yeild()            让出cpu  (测试和调试)</p>
<hr>
<h5 id="run-与-start"><a href="#run-与-start" class="headerlink" title="run()  与 start()"></a>run()  与 start()</h5><p>直接调用run()方法并不会开启新线程。</p>
<p>使用start() 开启新线程，然后由新线程去执行run()。</p>
<hr>
<p>sleep()  RUNNABLE  转换为  TIME_WAITING（<strong>阻塞态</strong>）</p>
<p><u>TimeUnit.时间单位.sleep(n);  可读性更强。</u></p>
<p><u>使用sleep或者yield让出cpu 防止cpu占到100%</u></p>
<p>interrupt()  打断线程睡眠</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;sleep &#123;&#125;&quot;</span>, currentThread().getName());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;interrupt&quot;</span>);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<hr>
<p>yield 会使线程从 Running -&gt; Runnable<strong>就绪状态</strong></p>
<hr>
<p>使用join进行线程同步。<code>t1.join()</code>主线程等待t1线程结束后再继续执行。</p>
<hr>
<p>使用interrupt()打断线程，可以通过thread.isInterrupted（）来判断是否被打断。</p>
<ul>
<li>当线程处于睡眠、等待状态被打断时就会将打断状态清空。</li>
<li>正常线程被打断，打断状态不会清空。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/07/JAVA/JUC/" data-id="clggal31p00036gu803sf9n14" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Paper/Pyramid" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/06/Paper/Pyramid/" class="article-date">
  <time datetime="2023-04-06T13:56:48.966Z" itemprop="datePublished">2023-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/06/Paper/Pyramid/">“分层分片区块链系统--金字塔 Pyramid：A Layered Sharding Blockchain System”</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>​    在本文中，我们提出了金字塔，第一层分片区块链系统。</p>
<p>​    其中一些分片可以存储多个分片的完整记录，从而可以在这些分片内部处理和验证跨分片交易。在提交跨分片事务时，为了实现相关分片之间的一致性，提出了基于多个分片之间协作的分层分片共识。</p>
<p>​    相比于完整分片，每个跨分片事务被分割成多个子事务，需要多轮共识提交，分层分片共识可以在一轮提交跨分片事务。</p>
<p>分片的主要思想:    主要思想是将节点划分为称为碎片的小组，可以并行处理事务。</p>
<p><img src="https://pic.imgdb.cn/item/642ed570a682492fcc4a0356.png" alt="5b322fe30b697758fe5f0685d88c4264_0_Figure_1_1546720846"></p>
<p>如上图所示，本文将b部分的完全分叉，变成了c部分的不完全分叉，存在交叉重合的部分（这些重合节点包含两个分片的所有信息）。</p>
<p>本文挑战：</p>
<ul>
<li>第一个挑战是关于共识协议设计，它指定了如何生成块以及如何验证块。现有的分片系统在每个分片中采用工作量证明(PoW)或基于拜占庭的区块提议方案。由于完全共享，分片可以独立地验证它们的块。然而，金字塔中的一些分片负责生成跨分片交易的区块。生成的块需要发送到相应的分片进行承诺，这使得共识协议设计更具挑战性。</li>
<li>第二个挑战是关于分片的构建，即需要多少个分片，哪些节点应该分配给哪些分片。不同于传统的分片方案，所有的分片都有相同的角色，金字塔中的分片扮演不同的角色。一些分片负责内部事务，而另一些则应该处理跨分片事务。对于金字塔系统，分片分配的研究至关重要，它决定了系统的吞吐量和安全水平。</li>
</ul>
<p>本文贡献：</p>
<ul>
<li>分层分片架构:我们介绍了分层分片的形成过程。通过我们的跨分片区块设计，跨分片交易可以被包含在一个区块中，以达成共识。</li>
<li>分层分片共识:我们提出了一种分层分片共识协议，根据不同分片中节点之间的协作，在每个分片中提交跨分片块。与将跨分片事务拆分为多个子事务并在多个共识轮中处理的完整分片相比，我们的分层分片共识可以在一轮中提交每个跨分片事务，从而提高了分片性能。</li>
<li>理论分析:从安全性、可扩展性、性能等方面对不同分片结构的Pyramid进行了理论分析，并将其与考虑多步事务分布的非分片和完整分片系统进行了比较。</li>
<li>系统实施:我们为金字塔开发了一个原型，并通过将其与两个最先进的完整分片系统进行比较来评估其性能。结果表明，在一个有17个分片、3500个节点的系统中，金字塔分片与完全分片相比，事务吞吐量提高了2.95倍。</li>
</ul>
<p>区块链分片的发展：</p>
<ul>
<li><p>不分片时期：</p>
<blockquote>
<p>而非分片系统的共识涉及到系统中的所有节点，这意味着每个节点都需要验证和存储系统中发生的所有事务，每个共识消息都需要在全网广播。这导致非分片系统的可伸缩性较差。</p>
</blockquote>
</li>
<li><p>部分分片系统：</p>
</li>
</ul>
<blockquote>
<p>ELASTICO实现了事务计算的分片，但它没有实现系统中存储和通信的分片，因此ELASTICO被称为部分分片系统。由于每个节点接收和存储系统的完整信息，系统中不存在跨分片的事务，但节点仍有较大的存储和带宽开销。</p>
</blockquote>
<ul>
<li>完全分片</li>
</ul>
<blockquote>
<p>omniedger[8]是第一个基于分片实现全分片的区块链系统。系统采用客户端驱动机制提交跨分片事务。然后，提出了另一个客户端驱动的分片系统Chainspace[11]，以支持通用智能合约的分片</p>
</blockquote>
<h4 id="系统和威胁模型"><a href="#系统和威胁模型" class="headerlink" title="系统和威胁模型"></a>系统和威胁模型</h4><ul>
<li><p>系统模型</p>
<p>系统有N个节点和S个分片，shard可分成两种类型：i-shard 和 b-shard。</p>
<p>i-shard: 与完整分片方案中的shard一致，只处理本分片内部的交易。</p>
<p>b-shard：它也可以处理分片内部的交易，同时他也承担了跨分片交易的处理。这种类型的节点通过处理与i-shard相关的跨shard事务来桥接多个i-shard的节点。</p>
<p>本文的Pyramid模型采用了账户/余额的形式。</p>
</li>
<li><p>威胁模型</p>
</li>
</ul>
<p>​        金字塔（Pyramid）中包含诚实节点和恶意节点。这里假设拜占庭对手是缓慢自适应的，恶意节点和诚实结点的集合在每个时代（epoch）都是固定的，只能在时代之间改变。</p>
<h4 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h4><ul>
<li><p>分层分片形成</p>
<ul>
<li><p>随机生成</p>
<blockquote>
<p>在每个epoch的开始都需要生成一个随机性（<strong>待</strong>）</p>
</blockquote>
</li>
</ul>
</li>
<li><p>节点加入epoch </p>
<blockquote>
<p>​      首先节点要根据epoch的随机性来解决一个pow谜题。 解决之后再将谜题的解记录到 标识区块链（<strong>待</strong>）中，注册其标识。</p>
<p>​      PoW谜题在每个epoch的难度可以根据上一个epoch的身份数量进行调整，以保持节点数量的稳定。如果上一纪元的nidentity多于上一纪元的，那么这一纪元的难度就会增加，否则难度就会降低。</p>
</blockquote>
</li>
<li><p>Assignment（任务）</p>
</li>
</ul>
<blockquote>
<p>每个被接纳的节点根据节点的身份和纪元中生成的随机性随机分配一个分片ID。shard ID分为i-shard ID和b-shard ID两种，每个b-shard ID对应若干个i-shard ID。</p>
</blockquote>
<ul>
<li><p>跨分片区块设计</p>
<ul>
<li><p>有效性验证</p>
<blockquote>
<p>​    每个交易的有效性可以分为源有效性和结果有效性。</p>
<p>​    源有效性表示发送方的状态满足交易的条件，即发送方有足够的资金;结果有效性表示接收方的状态符合交易的运行结果，即接收方收到了适当的资金。只有具有上述两种有效性的事务才被认为是有效的。</p>
<p>​    完整分片处理跨分片事务，需要分成3个子事务，2个内部事务和1个中继事务。</p>
</blockquote>
</li>
<li><p>区块设计</p>
<blockquote>
<p>​    每个分片（shard）都有自己的区块链。同时每个i-shard都会存一个区块链，而b-shard节点除了存储自己的区块链之外还会存储所有与其桥接的i-shard的区块链。</p>
</blockquote>
<p> 组成：每个跨分片的区块，都由块头和块体组成，如下图</p>
<p><img src="https://pic.imgdb.cn/item/642f8b6fa682492fccf8cf36.png" alt="image-20230407111739685"></p>
<p>​                header包括了与跨片交易相关的i-shard中的父块的散列以及body的Merkle树根。</p>
<p>​                body部分包括涉及到的分片交易，以及个分片中节点对应的账户状态。 </p>
</li>
<li><p>分层分片共识</p>
<p>每个epoch都要进行多轮共识，每轮共识都会根据epoch的随机性选择一个领导者。  </p>
<p>​    i-shard中的领导者 以提出一个包含其内部交易的区块，相应的共识过程类似于传统的完整分片系统（<strong>待</strong>）</p>
<p>​    b-shard的领导者可以提出一个包含其内部事务的块或与多个ishard关联的跨分片块。</p>
</li>
</ul>
</li>
</ul>
<p>​    <img src="https://pic.imgdb.cn/item/642f8ffca682492fccfe5bef.png"></p>
<p>上图展示了共识的过程：</p>
<p>​    1、pre-prepare阶段：b分片中的节点通过BFT协议实现跨分片块的共识，使用集体签名协议CoSi，该协议可以生成由分散的节点组共同签署的多重签名。具有三分之二超多数节点的集体签名的交叉分片块证明b分片在拜占庭环境下同意它。</p>
<p>​    跨分片块还不能提交，因为相关i-shard中的节点不知道该块，也没有根据跨分片事务更新其本地状态。这样，具有B分片集体证明的跨分片块将被发送到关联i-shard的节点，即i-shard A和B。</p>
<p>2.prepare阶段：每个ishard中的节点在收到b分片中带有集体证明的跨分片块后，可以根据身份区块链（<strong>待</strong>）中记录的公钥验证集体签名。然后，每个相关的i-shard也可以通过集体签名对区块达成共识。在成功达成共识后，i-shard向b-shard发送一个Accept消息，包括头部的散列和一个集体签名。注意，Reject消息的条件是关于块之间的冲突，这将在章节IV-D中给出。</p>
<p>3.commit阶段：在预准备阶段之后，b-shard中的节点用其相关的i-shard的数量初始化一个计数器。当b-shard中的节点从关联的i-shard接收到有效的Accept消息时，它将减少其本地计数器并将消息广播给bshard中的其他节点。当计数器等于0时，b分片中的节点可以确保跨分片块可以在本轮提交。</p>
<p>​    <strong>与PBFT一样，区块准备阶段不足以保证区块提交[6]，因此需要额外的集体签名来保证跨分片的区块提交，并向相关的i-shard发送包含header散列和集体签名的Commit消息。</strong>（<strong>待</strong>）</p>
<p><strong>transactions per second (TPS)</strong></p>
<ul>
<li>分析： 理论2的公式（待）  理论1中的两阶段提交（分布式系统中的事务提交）</li>
</ul>
<p>1.集体签名：Enhancing Bitcoin Security and Performance with Strong Consistency via Collective Signing</p>
<p>2.标识区块链： 搜一下吧 identify blockchain  </p>
<p>3.传递机制：Monoxide: Scale Out Blockchain with Asynchronous Consensus Zones</p>
<p><img src="C:\Users\JarNinLee\AppData\Roaming\Typora\typora-user-images\image-20230408205329375.png" alt="image-20230408205329375"></p>
<p><img src="C:\Users\JarNinLee\AppData\Roaming\Typora\typora-user-images\image-20230408205351760.png" alt="image-20230408205351760"></p>
<p><img src="C:\Users\JarNinLee\AppData\Roaming\Typora\typora-user-images\image-20230408205407633.png" alt="image-20230408205407633"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/06/Paper/Pyramid/" data-id="clggal31w000k6gu8bxdweg7i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/14/JAVA/JavaNote/Web/">HTML、CSS、HTTP、Servlet、JavaScript</a>
          </li>
        
          <li>
            <a href="/2023/04/14/JAVA/JavaNote/Tool/">Git、Linux、Docker</a>
          </li>
        
          <li>
            <a href="/2023/04/14/JAVA/JavaNote/SSM/">MyBatis、Spring、SpringMVC、SpringBoot、SpringCloud</a>
          </li>
        
          <li>
            <a href="/2023/04/14/JAVA/JavaNote/README/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/04/14/JAVA/JavaNote/Prog/">Concurrent、Network Programming</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>