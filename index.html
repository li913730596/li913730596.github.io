<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-11-20/error" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/09/11-20/error/" class="article-date">
  <time datetime="2023-04-09T15:00:42.793Z" itemprop="datePublished">2023-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/09/11-20/error/">异常处理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>当应用中产生异常时，Spring Boot根据发送请求头中的<code>accept</code>是否包含<code>text/html</code>来分别返回不同的响应信息。当从浏览器地址栏中访问应用接口时，请求头中的<code>accept</code>便会包含<code>text/html</code>信息，产生异常时，Spring Boot通过<code>org.springframework.web.servlet.ModelAndView</code>对象来装载异常信息，并以HTML的格式返回；而当从客户端访问应用接口产生异常时（客户端访问时，请求头中的<code>accept</code>不包含<code>text/html</code>），Spring Boot则以JSON的格式返回异常信息。下面来验证一下。</li>
</ul>
<p><img src="https://s1.ax1x.com/2023/04/09/ppb0yBF.png" alt="ppb0yBF.png"></p>
<ul>
<li>查看Spring Boot的<code>BasicErrorController</code>类便可看到这一默认机制的具体实现：</li>
</ul>
<p><img src="https://mrbird.cc/img/111111.png" alt="QQ图片20180701165727.png"></p>
<p>可看到<code>errorHtml</code>和<code>error</code>方法的请求地址和方法是一样的，唯一的区别就是<code>errorHtml</code>通过<code>produces = &#123;&quot;text/html&quot;&#125;</code>判断请求头的<code>accpet</code>属性中是否包含<code>text/html</code>，如果包含，便走该方法。</p>
<p>关于 produces参数含义可参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f78b43f048e6">https://www.jianshu.com/p/f78b43f048e6</a></p>
<ul>
<li>自定义异常界面：我们可以通过在<code>src/main/resources/resources/error</code>路径下自定义友好的异常页面</li>
</ul>
<ul>
<li>自定义异常处理：</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/09/11-20/error/" data-id="clg9ka58h0002y0u8b08f7n26" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-11-20/logback" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/09/11-20/logback/" class="article-date">
  <time datetime="2023-04-09T14:55:08.183Z" itemprop="datePublished">2023-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/09/11-20/logback/">日志配置（logback）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://logback.qos.ch/">Logback</a>是log4j框架的作者开发的新一代日志框架，它效率更高、能够适应诸多的运行环境，同时天然支持SLF4J。默认情况下，Spring Boot会用Logback来记录日志，并用INFO级别输出到控制台。在运行应用程序和其他例子时，你应该已经看到很多INFO级别的日志了</li>
</ul>
<p>后面再补…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/09/11-20/logback/" data-id="clg9ka58h0003y0u8hacm2wdd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JAVA/JUC_3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/09/JAVA/JUC_3/" class="article-date">
  <time datetime="2023-04-09T13:54:48.371Z" itemprop="datePublished">2023-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/09/JAVA/JUC_3/">并发第四章</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>避免临界区的静态条件（不确定结果）的发生<ul>
<li>阻塞式方案：synchronized（对象锁） ， Lock</li>
<li>非阻塞式解决方案：原子变量</li>
</ul>
</li>
</ul>
<p>synchornized加锁必须要   <strong>同时加同一个锁</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//synchornized用法的等价形式：</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//形式一：加在静态方法上</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//形式二： 锁住类对象  等价于 形式一</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (Test.class)&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Test&#123;</span><br><span class="line">//形式一</span><br><span class="line">    public synchronized void test()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//形式二   锁住当前对象</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        synchronized (this)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>线程八锁（<a target="_blank" rel="noopener" href="https://blog.csdn.net/F15217283411/article/details/122752255%EF%BC%89">https://blog.csdn.net/F15217283411/article/details/122752255）</a>  <u>只需判断是否是同一把锁</u></li>
</ul>
<hr>
<p>局部变量：是线程安全的（不与其他线程共享）</p>
<p>​        特别的，当变量为引用类型的时候，需要访问堆中数据，堆中数据为共享的。 （这时候可以将共用类型设置为局部变量）</p>
<p>private  和  final  修饰符  就可以进一步确保线程安全。（原因是，加上这些·修饰符，子类不能重写函数了）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">复习一波  子类重写父类</span></span><br><span class="line"><span class="comment">* 子类重写(覆盖)父类的方法必须满足的条件：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 1.父类中的方法在子类中必须可见，即子类继承了父类中的该方法(可以显式的使用super关键字来访问父类中的被重写的方法)，</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 如果父类中的方法为private类型的，那么子类则无法继承，也无法覆盖。   </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 2.子类和父类的方法必须是实例方法，如果父类是static方法而子类是实例方法，或者相反都会报错。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 如果父类和子类都是static方法，那么子类隐藏父类的方法，而不是重写父类方法。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 3.子类和父类的方法必须要具有相同的函数名称、参数列表，并且子类的返回值与父类相同或者是父类返回类型的子类型(jdk1.5之后)。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 如果方法名称相同而参数列表不同(返回类型可以相同也可以不同)，那么只是方法的重载，而非重写。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 如果方法名称和参数列表相同，返回值类型不同，子类返回值类型也不是父类返回值类型的子类，编译器就会报错。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 4.子类方法的访问权限不能小于父类方法的访问权限(可以具有相同的访问权限或者子类的访问权限大于父类)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 访问权限由高到低：public、protected、包访问权限、private。如果子类方法的访问权限低于父类，则编译器会给出错误信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* 5.子类方法不能比父类方法抛出更多的编译时异常(不是运行时异常)，即子类方法抛出的编译时异常或者和父类相同或者是父类异常的子类。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">原文链接：https://blog.csdn.net/weixin_30110807/article/details/114037808</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<ul>
<li> 另外  <strong>final</strong>可用于声明<strong>属性、方法和类</strong>，分别表示<strong>属性不可变，方法不可重写，类不可继承</strong>。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/09/JAVA/JUC_3/" data-id="clg9ka58f0001y0u86h7x4zu8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JAVA/JUC_2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/08/JAVA/JUC_2/" class="article-date">
  <time datetime="2023-04-08T07:32:05.185Z" itemprop="datePublished">2023-04-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/08/JAVA/JUC_2/">初级并发2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="两阶段终止模式"><a href="#两阶段终止模式" class="headerlink" title="两阶段终止模式"></a>两阶段终止模式</h3><p><img src="https://i.328888.xyz/2023/04/08/i3YIhV.png" alt="image-20230408153303612"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">TwoPhaseTermination</span> <span class="variable">tpt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TwoPhaseTermination</span>();</span><br><span class="line">        tpt.start();</span><br><span class="line">        Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">        tpt.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TwoPhaseTermination</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Thread monitor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>&#123;</span><br><span class="line">        monitor = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!currentThread().isInterrupted()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                        log.debug(<span class="string">&quot;执行监控&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        <span class="comment">//重新标记打断</span></span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;处理后事&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        monitor.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span>&#123;</span><br><span class="line">        monitor.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p><code>LockSupport.park();</code> 会使得线程停下。然后使用interrupt()将park()打断，线程才会继续执行。并且打断park()之后的打断标记依旧存在，再次调用park()就无法停下，需要将打断标记置为false，这时候就需要使用<code>interrupted()</code>方法,既可以打断程序，又能清楚打断标记。</p>
</li>
<li><p>守护线程： （可参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/quanxiaoha/p/10731361.html%EF%BC%89">https://www.cnblogs.com/quanxiaoha/p/10731361.html）</a></p>
</li>
</ul>
<ul>
<li><p>Java中的6种状态： </p>
<p><img src="https://s1.ax1x.com/2023/04/09/ppbYwL9.png" alt="ppbYwL9.png"></p>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2023/04/09/ppbtfpT.png" alt="ppbtfpT.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/08/JAVA/JUC_2/" data-id="clg9ka58c0000y0u827af1pyb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-11-20/mail" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/08/11-20/mail/" class="article-date">
  <time datetime="2023-04-08T05:07:53.091Z" itemprop="datePublished">2023-04-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/08/11-20/mail/">使用SpringBoot发邮件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>引入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在配置文件进行配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.qq.com</span></span><br><span class="line">    <span class="attr">username:</span> <span class="number">88888888</span><span class="string">@qq.com</span>   <span class="comment">#自己的qq</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">fmxazkhvfntbbbcf</span>  <span class="comment">#qq邮箱的授权码</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#上面是主要配置</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">mail:</span></span><br><span class="line">        <span class="attr">smtp:</span></span><br><span class="line">          <span class="attr">auth:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">starttls:</span></span><br><span class="line">            <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">required:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>详情参考：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021587834">https://segmentfault.com/a/1190000021587834</a></p>
<ul>
<li>使用模板发送邮件</li>
</ul>
<p>1.首先需要引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.在templates下创建一个模板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>模板<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    您好，您的验证码为&#123;code&#125;，请在两分钟内使用完成操作。</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.进行发送</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;sendTemplateEmail&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">sendTemplateEmail</span><span class="params">(String code)</span> &#123;</span><br><span class="line">       <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           message = jms.createMimeMessage();</span><br><span class="line">           <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">           helper.setFrom(from); </span><br><span class="line">           helper.setTo(<span class="string">&quot;888888@qq.com&quot;</span>); <span class="comment">// 接收地址</span></span><br><span class="line">           helper.setSubject(<span class="string">&quot;邮件摸板测试&quot;</span>); <span class="comment">// 标题</span></span><br><span class="line">           <span class="comment">// 处理邮件模板</span></span><br><span class="line">           <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">           context.setVariable(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">           <span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> templateEngine.process(<span class="string">&quot;emailTemplate&quot;</span>, context);</span><br><span class="line">           helper.setText(template, <span class="literal">true</span>);</span><br><span class="line">           jms.send(message);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;发送成功&quot;</span>;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           <span class="keyword">return</span> e.getMessage();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>





<ul>
<li>发送普通邮件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> JavaMailSender jms;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;spring.mail.username&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String from;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/sendSimpleEmail&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">sendSimpleEmail</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="type">SimpleMailMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line">          message.setFrom(from);</span><br><span class="line">          message.setTo(<span class="string">&quot;8888888@qq.com&quot;</span>); <span class="comment">// 接收地址  目标人的qq邮箱</span></span><br><span class="line">          message.setSubject(<span class="string">&quot;一封简单的邮件&quot;</span>); <span class="comment">// 标题</span></span><br><span class="line">          message.setText(<span class="string">&quot;使用Spring Boot发送简单邮件。&quot;</span>); <span class="comment">// 内容</span></span><br><span class="line">          jms.send(message);</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;发送成功&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">          <span class="keyword">return</span> e.getMessage();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<ul>
<li>发送Html邮件</li>
</ul>
<p>改造<code>EmailController</code>，<code>SimpleMailMessage</code>替换为<code>MimeMessage</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;sendHtmlEmail&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">sendHtmlEmail</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           message = jms.createMimeMessage();</span><br><span class="line">           <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">           helper.setFrom(from);</span><br><span class="line">           helper.setTo(<span class="string">&quot;888888@qq.com&quot;</span>); <span class="comment">// 接收地址</span></span><br><span class="line">           helper.setSubject(<span class="string">&quot;一封HTML格式的邮件&quot;</span>); <span class="comment">// 标题</span></span><br><span class="line">           <span class="comment">// 带HTML格式的内容</span></span><br><span class="line">           <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;&lt;p style=&#x27;color:#6db33f&#x27;&gt;使用Spring Boot发送HTML格式邮件。&lt;/p&gt;&quot;</span>);</span><br><span class="line">           helper.setText(sb.toString(), <span class="literal">true</span>);</span><br><span class="line">           jms.send(message);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;发送成功&quot;</span>;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           <span class="keyword">return</span> e.getMessage();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>发送带附件的邮箱</li>
</ul>
<p>发送带附件的邮件和普通邮件相比，其实就只是多了个传入附件的过程。不过使用的仍是<code>MimeMessage</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/sendAttachmentsMail&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">sendAttachmentsMail</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           message = jms.createMimeMessage();</span><br><span class="line">           <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">           helper.setFrom(from);</span><br><span class="line">           helper.setTo(<span class="string">&quot;913730596@qq.com&quot;</span>); <span class="comment">// 接收地址</span></span><br><span class="line">           helper.setSubject(<span class="string">&quot;一封带附件的邮件&quot;</span>); <span class="comment">// 标题</span></span><br><span class="line">           helper.setText(<span class="string">&quot;详情参见附件内容！&quot;</span>); <span class="comment">// 内容</span></span><br><span class="line">           <span class="comment">// 传入附件</span></span><br><span class="line">           <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;a.txt&quot;</span>);</span><br><span class="line">           <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> resource.getFile();</span><br><span class="line">           <span class="comment">//FileSystemResource file = new FileSystemResource(new File(&quot;classpath:/a.txt&quot;));</span></span><br><span class="line">           helper.addAttachment(<span class="string">&quot;a.txt&quot;</span>, file);</span><br><span class="line">           jms.send(message);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;发送成功&quot;</span>;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           <span class="keyword">return</span> e.getMessage();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>





<p>​        这里的文件路径：<code>Resource resource = new ClassPathResource(&quot;a.txt&quot;);</code>该语句将文件路径获取到，然后在获取文件资源<code>File file = resource.getFile();</code>。</p>
<p>​        详细可参考：<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15127619/4531376">https://blog.51cto.com/u_15127619/4531376</a></p>
<ul>
<li>发送带静态资源的Html</li>
</ul>
<p>​    发送带静态资源的邮件其实就是在发送HTML邮件的基础上嵌入静态资源（比如图片），嵌入静态资源的过程和传入附件类似，唯一的区别在于需要标识资源的cid：<code>helper.setText(&quot;&lt;html&gt;&lt;body&gt;博客图：&lt;img src=&#39;cid:img&#39;/&gt;&lt;/body&gt;&lt;/html&gt;&quot;, true);</code> 这里面的<code>cid:img</code>。与下面的<code>helper.addInline(&quot;img&quot;, file);</code>相对应即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helper.setText(<span class="string">&quot;&lt;html&gt;&lt;body&gt;博客图：&lt;img src=&#x27;cid:img&#x27;/&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>, <span class="literal">true</span>); <span class="comment">// 内容</span></span><br><span class="line"><span class="comment">// 传入附件</span></span><br><span class="line"><span class="type">FileSystemResource</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;src/main/resources/static/img/sunshine.png&quot;</span>));</span><br><span class="line">helper.addInline(<span class="string">&quot;img&quot;</span>, file); </span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/08/11-20/mail/" data-id="clg7nd9cd0000kku800b01h0p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JAVA/JUC" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/07/JAVA/JUC/" class="article-date">
  <time datetime="2023-04-07T07:13:36.860Z" itemprop="datePublished">2023-04-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/07/JAVA/JUC/">并发初级</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="4-7"><a href="#4-7" class="headerlink" title="4.7"></a>4.7</h3><p>并发 (deal)  并行（do）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">//方法一</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">                log.info(<span class="string">&quot;inThread&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread.setName(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//方法一的简化：利用lamaba</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; log.info(<span class="string">&quot;inThread&quot;</span>)).start();</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">		<span class="comment">//方法二：利用Runnable接口</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">inThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;inThread&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(inThread, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;outThread&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>针对Runnable 接口  和  Thread直接创建这两种方式， 推荐使用Runnable接口的实现，这样就可以将我们创建的任务与Thread类分离开。</li>
</ul>
<ul>
<li>第三种创建线程的方式：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Callable</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                log.info(<span class="string">&quot;inThread&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask,<span class="string">&quot;t3&quot;</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(futureTask.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">-----------</span><br><span class="line">结果：</span><br><span class="line"><span class="number">2023</span>-<span class="number">04</span>-<span class="number">07</span> <span class="number">16</span>:<span class="number">05</span>:<span class="number">25.435</span>  INFO <span class="number">4032</span> --- [  t3] com.example.Jucday01ApplicationTests     : inThread</span><br><span class="line"><span class="number">100</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/642fcdc7a682492fcc520dff.png" alt="image-20230407160047480"></p>
<p><img src="https://pic.imgdb.cn/item/642fd047a682492fcc559865.png" alt="image-20230407161142009"></p>
<p>​        <strong>本质上还是继承了Runnable,只不过为了能够得到线程中任务的返回值，需要传入一个Callable接口的参数，这个接口下的call方法是有返回值的。 同时又因为，FutureTask继承了Future接口 所以可以用get()方法获取call方法的返回值。</strong></p>
<ul>
<li>线程上下文切换：cpu不再执行当前的线程，转而执行另一个线程。每次切换线程时，操作系统都需要记录线程当前的状态（记录现场）    </li>
</ul>
<p><img src="https://pic.imgdb.cn/item/642fff96a682492fcccca49d.png" alt="image-20230407193313881"></p>
<ul>
<li>栈帧：每多开一个线程，jvm都会给它开辟一块栈空间，叫做栈帧。</li>
</ul>
<h3 id="4-8"><a href="#4-8" class="headerlink" title="4.8"></a>4.8</h3><ul>
<li>常用方法</li>
</ul>
<hr>
<p>join()        等待线程运行结束  ；  join(n)  最多等n毫秒；</p>
<p>getState()  获取线程状态；</p>
<p>isInterrupted() 判断是否打断；</p>
<p>isAlive()  判断线程是否存活；</p>
<p>currentThread()   获取当前线程；</p>
<p>sleep(n)      休眠n毫秒，让出cpu（但不释放锁）</p>
<p>yeild()            让出cpu  (测试和调试)</p>
<hr>
<h5 id="run-与-start"><a href="#run-与-start" class="headerlink" title="run()  与 start()"></a>run()  与 start()</h5><p>直接调用run()方法并不会开启新线程。</p>
<p>使用start() 开启新线程，然后由新线程去执行run()。</p>
<hr>
<p>sleep()  RUNNABLE  转换为  TIME_WAITING（<strong>阻塞态</strong>）</p>
<p><u>TimeUnit.时间单位.sleep(n);  可读性更强。</u></p>
<p><u>使用sleep或者yield让出cpu 防止cpu占到100%</u></p>
<p>interrupt()  打断线程睡眠</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;sleep &#123;&#125;&quot;</span>, currentThread().getName());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;interrupt&quot;</span>);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<hr>
<p>yield 会使线程从 Running -&gt; Runnable<strong>就绪状态</strong></p>
<hr>
<p>使用join进行线程同步。<code>t1.join()</code>主线程等待t1线程结束后再继续执行。</p>
<hr>
<p>使用interrupt()打断线程，可以通过thread.isInterrupted（）来判断是否被打断。</p>
<ul>
<li>当线程处于睡眠、等待状态被打断时就会将打断状态清空。</li>
<li>正常线程被打断，打断状态不会清空。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/07/JAVA/JUC/" data-id="clg69u26d000ai4u8hzefa18u" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Paper/Pyramid" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/06/Paper/Pyramid/" class="article-date">
  <time datetime="2023-04-06T13:56:48.966Z" itemprop="datePublished">2023-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/06/Paper/Pyramid/">“分层分片区块链系统--金字塔 Pyramid：A Layered Sharding Blockchain System”</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>​    在本文中，我们提出了金字塔，第一层分片区块链系统。</p>
<p>​    其中一些分片可以存储多个分片的完整记录，从而可以在这些分片内部处理和验证跨分片交易。在提交跨分片事务时，为了实现相关分片之间的一致性，提出了基于多个分片之间协作的分层分片共识。</p>
<p>​    相比于完整分片，每个跨分片事务被分割成多个子事务，需要多轮共识提交，分层分片共识可以在一轮提交跨分片事务。</p>
<p>分片的主要思想:    主要思想是将节点划分为称为碎片的小组，可以并行处理事务。</p>
<p><img src="https://pic.imgdb.cn/item/642ed570a682492fcc4a0356.png" alt="5b322fe30b697758fe5f0685d88c4264_0_Figure_1_1546720846"></p>
<p>如上图所示，本文将b部分的完全分叉，变成了c部分的不完全分叉，存在交叉重合的部分（这些重合节点包含两个分片的所有信息）。</p>
<p>本文挑战：</p>
<ul>
<li>第一个挑战是关于共识协议设计，它指定了如何生成块以及如何验证块。现有的分片系统在每个分片中采用工作量证明(PoW)或基于拜占庭的区块提议方案。由于完全共享，分片可以独立地验证它们的块。然而，金字塔中的一些分片负责生成跨分片交易的区块。生成的块需要发送到相应的分片进行承诺，这使得共识协议设计更具挑战性。</li>
<li>第二个挑战是关于分片的构建，即需要多少个分片，哪些节点应该分配给哪些分片。不同于传统的分片方案，所有的分片都有相同的角色，金字塔中的分片扮演不同的角色。一些分片负责内部事务，而另一些则应该处理跨分片事务。对于金字塔系统，分片分配的研究至关重要，它决定了系统的吞吐量和安全水平。</li>
</ul>
<p>本文贡献：</p>
<ul>
<li>分层分片架构:我们介绍了分层分片的形成过程。通过我们的跨分片区块设计，跨分片交易可以被包含在一个区块中，以达成共识。</li>
<li>分层分片共识:我们提出了一种分层分片共识协议，根据不同分片中节点之间的协作，在每个分片中提交跨分片块。与将跨分片事务拆分为多个子事务并在多个共识轮中处理的完整分片相比，我们的分层分片共识可以在一轮中提交每个跨分片事务，从而提高了分片性能。</li>
<li>理论分析:从安全性、可扩展性、性能等方面对不同分片结构的Pyramid进行了理论分析，并将其与考虑多步事务分布的非分片和完整分片系统进行了比较。</li>
<li>系统实施:我们为金字塔开发了一个原型，并通过将其与两个最先进的完整分片系统进行比较来评估其性能。结果表明，在一个有17个分片、3500个节点的系统中，金字塔分片与完全分片相比，事务吞吐量提高了2.95倍。</li>
</ul>
<p>区块链分片的发展：</p>
<ul>
<li><p>不分片时期：</p>
<blockquote>
<p>而非分片系统的共识涉及到系统中的所有节点，这意味着每个节点都需要验证和存储系统中发生的所有事务，每个共识消息都需要在全网广播。这导致非分片系统的可伸缩性较差。</p>
</blockquote>
</li>
<li><p>部分分片系统：</p>
</li>
</ul>
<blockquote>
<p>ELASTICO实现了事务计算的分片，但它没有实现系统中存储和通信的分片，因此ELASTICO被称为部分分片系统。由于每个节点接收和存储系统的完整信息，系统中不存在跨分片的事务，但节点仍有较大的存储和带宽开销。</p>
</blockquote>
<ul>
<li>完全分片</li>
</ul>
<blockquote>
<p>omniedger[8]是第一个基于分片实现全分片的区块链系统。系统采用客户端驱动机制提交跨分片事务。然后，提出了另一个客户端驱动的分片系统Chainspace[11]，以支持通用智能合约的分片</p>
</blockquote>
<h4 id="系统和威胁模型"><a href="#系统和威胁模型" class="headerlink" title="系统和威胁模型"></a>系统和威胁模型</h4><ul>
<li><p>系统模型</p>
<p>系统有N个节点和S个分片，shard可分成两种类型：i-shard 和 b-shard。</p>
<p>i-shard: 与完整分片方案中的shard一致，只处理本分片内部的交易。</p>
<p>b-shard：它也可以处理分片内部的交易，同时他也承担了跨分片交易的处理。这种类型的节点通过处理与i-shard相关的跨shard事务来桥接多个i-shard的节点。</p>
<p>本文的Pyramid模型采用了账户/余额的形式。</p>
</li>
<li><p>威胁模型</p>
</li>
</ul>
<p>​        金字塔（Pyramid）中包含诚实节点和恶意节点。这里假设拜占庭对手是缓慢自适应的，恶意节点和诚实结点的集合在每个时代（epoch）都是固定的，只能在时代之间改变。</p>
<h4 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h4><ul>
<li><p>分层分片形成</p>
<ul>
<li><p>随机生成</p>
<blockquote>
<p>在每个epoch的开始都需要生成一个随机性（<strong>待</strong>）</p>
</blockquote>
</li>
</ul>
</li>
<li><p>节点加入epoch </p>
<blockquote>
<p>​      首先节点要根据epoch的随机性来解决一个pow谜题。 解决之后再将谜题的解记录到 标识区块链（<strong>待</strong>）中，注册其标识。</p>
<p>​      PoW谜题在每个epoch的难度可以根据上一个epoch的身份数量进行调整，以保持节点数量的稳定。如果上一纪元的nidentity多于上一纪元的，那么这一纪元的难度就会增加，否则难度就会降低。</p>
</blockquote>
</li>
<li><p>Assignment（任务）</p>
</li>
</ul>
<blockquote>
<p>每个被接纳的节点根据节点的身份和纪元中生成的随机性随机分配一个分片ID。shard ID分为i-shard ID和b-shard ID两种，每个b-shard ID对应若干个i-shard ID。</p>
</blockquote>
<ul>
<li><p>跨分片区块设计</p>
<ul>
<li><p>有效性验证</p>
<blockquote>
<p>​    每个交易的有效性可以分为源有效性和结果有效性。</p>
<p>​    源有效性表示发送方的状态满足交易的条件，即发送方有足够的资金;结果有效性表示接收方的状态符合交易的运行结果，即接收方收到了适当的资金。只有具有上述两种有效性的事务才被认为是有效的。</p>
<p>​    完整分片处理跨分片事务，需要分成3个子事务，2个内部事务和1个中继事务。</p>
</blockquote>
</li>
<li><p>区块设计</p>
<blockquote>
<p>​    每个分片（shard）都有自己的区块链。同时每个i-shard都会存一个区块链，而b-shard节点除了存储自己的区块链之外还会存储所有与其桥接的i-shard的区块链。</p>
</blockquote>
<p> 组成：每个跨分片的区块，都由块头和块体组成，如下图</p>
<p><img src="https://pic.imgdb.cn/item/642f8b6fa682492fccf8cf36.png" alt="image-20230407111739685"></p>
<p>​                header包括了与跨片交易相关的i-shard中的父块的散列以及body的Merkle树根。</p>
<p>​                body部分包括涉及到的分片交易，以及个分片中节点对应的账户状态。 </p>
</li>
<li><p>分层分片共识</p>
<p>每个epoch都要进行多轮共识，每轮共识都会根据epoch的随机性选择一个领导者。  </p>
<p>​    i-shard中的领导者 以提出一个包含其内部交易的区块，相应的共识过程类似于传统的完整分片系统（<strong>待</strong>）</p>
<p>​    b-shard的领导者可以提出一个包含其内部事务的块或与多个ishard关联的跨分片块。</p>
</li>
</ul>
</li>
</ul>
<p>​    <img src="https://pic.imgdb.cn/item/642f8ffca682492fccfe5bef.png"></p>
<p>上图展示了共识的过程：</p>
<p>​    1、pre-prepare阶段：b分片中的节点通过BFT协议实现跨分片块的共识，使用集体签名协议CoSi，该协议可以生成由分散的节点组共同签署的多重签名。具有三分之二超多数节点的集体签名的交叉分片块证明b分片在拜占庭环境下同意它。</p>
<p>​    跨分片块还不能提交，因为相关i-shard中的节点不知道该块，也没有根据跨分片事务更新其本地状态。这样，具有B分片集体证明的跨分片块将被发送到关联i-shard的节点，即i-shard A和B。</p>
<p>2.prepare阶段：每个ishard中的节点在收到b分片中带有集体证明的跨分片块后，可以根据身份区块链（<strong>待</strong>）中记录的公钥验证集体签名。然后，每个相关的i-shard也可以通过集体签名对区块达成共识。在成功达成共识后，i-shard向b-shard发送一个Accept消息，包括头部的散列和一个集体签名。注意，Reject消息的条件是关于块之间的冲突，这将在章节IV-D中给出。</p>
<p>3.commit阶段：在预准备阶段之后，b-shard中的节点用其相关的i-shard的数量初始化一个计数器。当b-shard中的节点从关联的i-shard接收到有效的Accept消息时，它将减少其本地计数器并将消息广播给bshard中的其他节点。当计数器等于0时，b分片中的节点可以确保跨分片块可以在本轮提交。</p>
<p>​    <strong>与PBFT一样，区块准备阶段不足以保证区块提交[6]，因此需要额外的集体签名来保证跨分片的区块提交，并向相关的i-shard发送包含header散列和集体签名的Commit消息。</strong>（<strong>待</strong>）</p>
<p><strong>transactions per second (TPS)</strong></p>
<ul>
<li>分析： 理论2的公式（待）  理论1中的两阶段提交</li>
</ul>
<p>1.集体签名：Enhancing Bitcoin Security and Performance with Strong Consistency via Collective Signing</p>
<p>2.标识区块链： 搜一下吧 identify blockchain  </p>
<p>3.传递机制：Monoxide: Scale Out Blockchain with Asynchronous Consensus Zones</p>
<p><img src="C:\Users\JarNinLee\AppData\Roaming\Typora\typora-user-images\image-20230408205329375.png" alt="image-20230408205329375"></p>
<p><img src="C:\Users\JarNinLee\AppData\Roaming\Typora\typora-user-images\image-20230408205351760.png" alt="image-20230408205351760"></p>
<p><img src="C:\Users\JarNinLee\AppData\Roaming\Typora\typora-user-images\image-20230408205407633.png" alt="image-20230408205407633"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/06/Paper/Pyramid/" data-id="clg6b85h10000eou86izp873g" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-11-20/Json" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/06/11-20/Json/" class="article-date">
  <time datetime="2023-04-06T11:17:50.147Z" itemprop="datePublished">2023-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/06/11-20/Json/">实体对象的序列化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>首先验证一下 @RequestBody  注解返回的是Json元素</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUserName(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">11</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">6222176558369919436L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>最终结果为：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;userName&quot;: &quot;123&quot;,</span><br><span class="line">    &quot;age&quot;: 11,</span><br><span class="line">    &quot;password&quot;: null,</span><br><span class="line">    &quot;birthday&quot;: &quot;2023-04-06T11:23:54.701+00:00&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还可以自己改变输出时间的格式，通过创造一个配置类来设置时间属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ObjectMapper <span class="title function_">getObjectMapper</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        objectMapper.setDateFormat(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> objectMapper;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>可以得到结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;birthday&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-04-06 19:29:43&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><ul>
<li>Jackson通过使用mapper的<code>writeValueAsString</code>方法将Java对象序列化为JSON格式字符串：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/serialization&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">serialization</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setUserName(<span class="string">&quot;Jar&quot;</span>);</span><br><span class="line">            user.setBirthday(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> objectMapper.writeValueAsString(user);</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;userName&quot;:&quot;Jar&quot;,&quot;age&quot;:0,&quot;password&quot;:null,&quot;birthday&quot;:&quot;2023-04-06 19:34:14&quot;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><ul>
<li>使用<code>@ResponseBody</code>注解可以使对象序列化为JSON格式字符串，除此之外，Jackson也提供了反序列化方法。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/readjsonstring&quot;)</span><br><span class="line">    public String readJsonString() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            String json = &quot;&#123;\&quot;name\&quot;:\&quot;Jar\&quot;,\&quot;age\&quot;:26&#125;&quot;;</span><br><span class="line">            JsonNode node = objectMapper.readTree(json);</span><br><span class="line">            String name = node.get(&quot;name&quot;).asText();</span><br><span class="line">            int age = node.get(&quot;age&quot;).asInt();</span><br><span class="line">            return name + &quot; &quot; + age;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Jar 26</span><br></pre></td></tr></table></figure>





<ul>
<li><code>readTree</code>方法可以接受一个字符串或者字节数组、文件、InputStream等， 返回JsonNode作为根节点，你可以像操作XML DOM那样操作遍历JsonNode以获取数据。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private ObjectMapper mapper;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   void contextLoads() &#123;</span><br><span class="line">       try &#123;</span><br><span class="line">       </span><br><span class="line">           String json = &quot;&#123;\&quot;name\&quot;:\&quot;mrbird\&quot;,\&quot;hobby\&quot;:&#123;\&quot;first\&quot;:\&quot;sleep\&quot;,\&quot;second\&quot;:\&quot;eat\&quot;&#125;&#125;&quot;;;</span><br><span class="line">           JsonNode node = null;</span><br><span class="line">           node = mapper.readTree(json);</span><br><span class="line">           JsonNode hobby = node.get(&quot;hobby&quot;);</span><br><span class="line">           String first = hobby.get(&quot;first&quot;).asText();</span><br><span class="line">           System.out.println(first);    							//   结果为：sleep</span><br><span class="line">           </span><br><span class="line">       &#125; catch (JsonProcessingException e) &#123;</span><br><span class="line">           throw new RuntimeException(e);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>





<h3 id="绑定对象"><a href="#绑定对象" class="headerlink" title="绑定对象"></a>绑定对象</h3><p>将Java实体对象与Json对象绑定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/readjsonasobject&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">readJsonAsObject</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;userName\&quot;:\&quot;Jar\&quot;,\&quot;age\&quot;:26&#125;&quot;</span>;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> objectMapper.readValue(json, User.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> user.getUserName();</span><br><span class="line">        <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> user.getAge();</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot; &quot;</span> + age;      					<span class="comment">//    结果为： “Jar 26”</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    	e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="Jackson的一些注解"><a href="#Jackson的一些注解" class="headerlink" title="Jackson的一些注解"></a>Jackson的一些注解</h3><p>详情参考：<a target="_blank" rel="noopener" href="https://mrbird.cc/Spring-Boot%20JSON.html">https://mrbird.cc/Spring-Boot%20JSON.html</a></p>
<ul>
<li><h5 id="JsonFormat"><a href="#JsonFormat" class="headerlink" title="@JsonFormat"></a>@JsonFormat</h5></li>
</ul>
<p>​    用来格式化日期</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@JsonFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">private Date birthday;</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/06/11-20/Json/" data-id="clg69u2650002i4u8h6sk2nia" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Paper/BlockChain" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/06/Paper/BlockChain/" class="article-date">
  <time datetime="2023-04-06T04:11:09.744Z" itemprop="datePublished">2023-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/06/Paper/BlockChain/">区块链</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="区块链的性能问题以及扩展问题"><a href="#区块链的性能问题以及扩展问题" class="headerlink" title="区块链的性能问题以及扩展问题"></a>区块链的性能问题以及扩展问题</h1><h5 id="交易吞吐量和交易速度限制了比特币、以太坊等区块链平台的交易数量，扩容是目前区块链需要解决的一大问题。"><a href="#交易吞吐量和交易速度限制了比特币、以太坊等区块链平台的交易数量，扩容是目前区块链需要解决的一大问题。" class="headerlink" title="交易吞吐量和交易速度限制了比特币、以太坊等区块链平台的交易数量，扩容是目前区块链需要解决的一大问题。"></a>交易吞吐量和交易速度限制了比特币、以太坊等区块链平台的交易数量，扩容是目前区块链需要解决的一大问题。</h5><p>三种层次的方案图：</p>
<p><img src="https://pic.imgdb.cn/item/642e6cbba682492fccbc1e3a.png" alt="image-20230406145419098"></p>
<ul>
<li><p>链上扩展(扩容方案)</p>
<ul>
<li><p>一次生成多个区块</p>
<p>例如：Bitcoin-NG:</p>
<blockquote>
<p>​    使用了PoW工作量证明共识协议来选择领导者，领导者可以写入一个主块和多个微块，主块中不包含任何交易信息，只负责记录领导者的选举过程和结果，交易信息记录在微块中。</p>
<p>​    在每个领导者被选举出来后，该领导者在一段时间内负责所有交易信息的验证和打包工作，即生成微块，此过程不涉及PoW共识机制，因此记账速度得到提升，区块链系统的交易吞吐量也随之提升。</p>
</blockquote>
</li>
<li><p>混合共识协议</p>
<p>例如：Algorand：</p>
<blockquote>
<p>Algorand将PoW/PoS共识思想用于委员会创建，拜占庭思想用于委员会内部达成共识。</p>
</blockquote>
</li>
<li><p>分片</p>
<blockquote>
<p>​    通过改变网络内部各步骤之间的验证方式来提高区块链可扩展性的一种方法.</p>
<p>​    其核心思想是“化整为零”，将区块链网络划分成若干能够处理交易的较小组件式网络，以实现每秒处理数千笔交易的支付系统。</p>
<p>​    <em><u><strong>分片机制需要面临的挑战是1%攻击, 即保证攻击者在分片过程中无法在任何一个分片中实现51%攻击, 以及如何保证攻击者无法在分片处理交易的过程中, 实现双花攻击.   以及 如何快速处理跨碎片事务，同时确保这些事务的一致性。</strong></u></em></p>
</blockquote>
<ul>
<li><p>网络分片</p>
<blockquote>
<p>网络分片是随机选择节点形成分片，分片内利用共识协议达成一致</p>
</blockquote>
</li>
<li><p>交易分片</p>
<blockquote>
<p>交易分片是根据交易地址分片，便于在分片内检测双花</p>
</blockquote>
</li>
<li><p>状态分片</p>
<blockquote>
<p>状态分片指的是划分存储区，每个分区只储存分片数据，而不是存储完整的区块链状态</p>
<p><em><strong>如何确保跨分片通信成本不会超过状态分片的所获的的性能增益仍然是一个值得深入研究的问题</strong></em></p>
</blockquote>
</li>
</ul>
<p><u>在网络和交易分片中，每个节点存储着系统的全部状态，所以各个分片之间不需要频繁的交流去确认其他分片的状态。</u></p>
<p><u>状态分片，显然最大的优势是他解决的日益庞大的存储问题。</u></p>
<p>关于分片的参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/gaohaoyang0123/article/details/96743105">https://blog.csdn.net/gaohaoyang0123/article/details/96743105</a></p>
<hr>
<p>​    Elastico的方案基于UTXO模型, 因此在交易处理时, 通过<strong>交易的输入作为基准映射</strong>到不同的分片处理.在UTXO模型中, 攻击者想要实现双花必须产生2笔<strong>引用同一输出</strong>（作为输入）的交易.</p>
<p>​    Zilliqa的方案基于账户模型, 因此在交易处理时, 通过<strong>发送者的身份作为基准</strong>映射到不同的分片中.一轮共识过程中, 不同发送者的交易可能映射到不同的分片 (不同验证者) ,但<strong>同一发送者的交易都会由同一分片处理</strong>, 因此分片内的诚实节点对特定发送者的状态是确定的.因此其能够在基于账户的模型下抵御双花攻击.</p>
<hr>
</li>
<li></li>
<li><p>有向无环图结构</p>
<blockquote>
<p>有向无环图结构是一种非线性数据结构，将其应用到区块链中，从拓扑结构角度改变了区块的单向链接形式，支持并发上链，平行验证。    </p>
</blockquote>
</li>
</ul>
</li>
<li><p>链下扩展(扩容)</p>
<ul>
<li><p>状态通道（子链）</p>
<blockquote>
<p>​    最早的状态通道是闪电网络。</p>
<p>​    双方节点直接建立的点对点渠道，双方可以在通道内快速地进行交易并保证状态可以随时被公开，通道关闭时，最终状态会传回到链上。</p>
<p>​    通道内的交易转账的安全性主要依靠数字签名、合约锁定等技术保障。</p>
</blockquote>
</li>
<li><p>链下计算链上验证</p>
<blockquote>
<p>链下外包执行机制。用户上传代码任务并提供少量佣金，链外外包用户代理执行并提供足够执行链上合约数量的保证金，其他链上节点充当验证者的角色监督代码执行的正确性。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h1 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h1><hr>
<ul>
<li><p><strong>存在的问题</strong>：整个分片机制在运行过程中有大量时间用于处理交易以外的工作，同时，为了防止节点作恶，不少分片技术需要大量时间和开销进行分片重配置</p>
<ul>
<li>小规模的分片意味对双花攻击防御能力的下降，安全性更高的片内共识协议也将付出更高的共识代价，大多数协议对于安全性的分析集中在<strong>拜占庭对手规模、信息可靠性以及分片随机性方面</strong></li>
</ul>
</li>
<li><p>分片除了上面说到的 还有一些解决方案提出了一种新的结构，由主链和多个分片链组成。（如下图）</p>
<p><img src="https://pic.imgdb.cn/item/642e6ad9a682492fccb9b38e.png"></p>
<p>每个分片维护一个分片链，并定期将其状态提交到主链。从上图 所示的架构中，我们可以看到每个分片都有一个专用的链。在这种架构下，跨分片事务通过主链处理，允许接收不同分片提交的跨分片事务，可以通过所有分片进行验证，以确保跨分片事务的正确性。然而，当跨分片事务的规模在区块链系统中增加时，主链将成为整体系统的瓶颈，因为大量的事务给存储和通信带来了很大的压力。</p>
</li>
</ul>
<h1 id="有关的知识点"><a href="#有关的知识点" class="headerlink" title="有关的知识点"></a>有关的知识点</h1><ul>
<li>1.环签名</li>
</ul>
<blockquote>
<p>环签名具有无条件匿名性，攻击者即使非法获取了所有可能签名者的私钥，也无法确定签名是由环中哪个成员生成的，实现了签名人身份的隐藏。同时具有不可伪造性，攻击者在不知道任何成员私钥的情况下，无法成功伪造一个合法的签名。</p>
<p>流程：</p>
<p>​    (1)密钥生成，为环中的成员产生（PKi,SKi）密钥对；</p>
<p>​    (2)签名，签名者用自己的私钥x和任意n个环成员的公钥为消息m生成签名；</p>
<p>​    (3)签名验证，验证者根据签名和消息m，验证签名是否为环中成员所签，如果有效就接收，否则丢弃。</p>
</blockquote>
<ul>
<li>2.零知识证明</li>
</ul>
<blockquote>
<p>​    证明者能够在不向验证者提供任何有用的信息的情况下，使验证者相信某个论断是正确的。</p>
</blockquote>
<ul>
<li>3.安全多方计算</li>
</ul>
<blockquote>
<p>在各方不可信的情况下，不泄露输入数据来安全地进行多方协同的计算</p>
</blockquote>
<hr>
<hr>
<h1 id="共识协议"><a href="#共识协议" class="headerlink" title="共识协议"></a>共识协议</h1><ul>
<li><p><strong>分布式系统面临的一致性问题：拜占庭将军问题；</strong></p>
</li>
<li><p><strong>共识算法的核心就是解决拜占庭将军问题。</strong></p>
</li>
<li><p><strong>共识机制就是用来解决分布式系统的一致性问题,其核心为在某个协议(共识算法)保障下,在有限的时间内,使得指定操作在分布式网络中是一致的、被承认的、不可篡改的。</strong></p>
</li>
</ul>
<p>​    在中心化的分布式系统   兰伯特提出了Paxos算法。</p>
<p>​    在去中心化的分布式系统（区块链），1999年PBFT算法（Practical Byzantine Fault Tolerance, 实用的拜占庭容错算法）。</p>
<blockquote>
<p>1.叛徒等于或大于三分之一，拜占庭问题无解；<br>2.当叛徒数量不到三分之一，那么忠诚将军就至少有三分之二，此时拜占庭问题有解，仍然可以达到容错。</p>
</blockquote>
<p>​    在比特币中采用了POW的基于工作量证明的共识机制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.POW工作量证明机制提高了做叛徒（发布虚假区块）的成本，在工作量证明下，只有第一个完成证明的节点才能广播区块，竞争难度非常大，需要很高算例，如果不成功其算力就白白的耗费了（算力是需要成本的），如果有这样的算力作为诚实的节点，可以获得很大的收益（这就是矿工所作的工作），这也实际就不会有做叛徒的动机，整个系统也因此而更稳定。</span><br><span class="line">b.对于51%攻击问题，那更是提高了做叛徒的成本。拥有这么大的算力的，自然就是希望依赖比特币系统而盈利的，当然更不会造假而损坏自身利益。</span><br><span class="line">c.当然很多人批评POW工作量证明机制造成巨大的电力浪费，促使人们去探索新的解决一致性（共识）问题的机制：权益证明机制（POS : proof  of  Stake）是一个代表。在拜占庭将军问题的角度来看，它同样提高了做叛徒的成本，因为账户需要首先持有大量余额才能有更多的几率广播区块。如果已经拥有这么大的利益，当然更不会造假而损坏自身利益了。</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/06/Paper/BlockChain/" data-id="clg69u26b0005i4u8af490h5u" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-1-10/cache" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/04/05/1-10/cache/" class="article-date">
  <time datetime="2023-04-05T14:55:12.059Z" itemprop="datePublished">2023-04-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/04/05/1-10/cache/">使用缓存</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>springboot  开启缓存：</p>
<ul>
<li>引入依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>开启缓存功能<code>@EnableCaching</code></li>
</ul>
<ul>
<li>下载Redis : <a target="_blank" rel="noopener" href="https://github.com/MicrosoftArchive/redis/releases">https://github.com/MicrosoftArchive/redis/releases</a></li>
<li>引入Redis依赖</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/05/1-10/cache/" data-id="clg69u26d000bi4u8h4847lif" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/09/11-20/error/">异常处理</a>
          </li>
        
          <li>
            <a href="/2023/04/09/11-20/logback/">日志配置（logback）</a>
          </li>
        
          <li>
            <a href="/2023/04/09/JAVA/JUC_3/">并发第四章</a>
          </li>
        
          <li>
            <a href="/2023/04/08/JAVA/JUC_2/">初级并发2</a>
          </li>
        
          <li>
            <a href="/2023/04/08/11-20/mail/">使用SpringBoot发邮件</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>